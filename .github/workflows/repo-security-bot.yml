name: "ðŸ”’ Repo Security Bot â€“ Summary"

on:
  push:
    branches: [ main ]
  pull_request:
  schedule:
    - cron: "0 12 * * *"
  workflow_dispatch:

jobs:
  generate-summary:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # ------------ CALL TOOL WORKFLOWS -------------
      - name: Run Gitleaks scan
        uses: ./.github/workflows/scan-gitleaks.yml

      - name: Run Snyk scan
        uses: ./.github/workflows/scan-snyk.yml

      - name: Run Checkov scan
        uses: ./.github/workflows/scan-checkov.yml

      - name: Run Dockle scan
        uses: ./.github/workflows/scan-dockle.yml

      - name: Run Bandit scan
        uses: ./.github/workflows/scan-bandit.yml

      # ------------ DOWNLOAD ARTIFACTS -------------
      - name: Download Gitleaks report
        uses: actions/download-artifact@v4
        with:
          name: gitleaks-report

      - name: Download Snyk report
        uses: actions/download-artifact@v4
        with:
          name: snyk-report

      - name: Download Checkov report
        uses: actions/download-artifact@v4
        with:
          name: checkov-report

      - name: Download Dockle report
        uses: actions/download-artifact@v4
        with:
          name: dockle-report

      - name: Download Bandit report
        uses: actions/download-artifact@v4
        with:
          name: bandit-report

      - name: Create reports folder
        run: mkdir -p reports

      - name: Move reports
        run: |
          mv gitleaks.json reports/
          mv snyk.json reports/
          mv checkov_results.json reports/
          mv dockle.json reports/
          mv bandit.json reports/

      # ------------ SUMMARY GENERATION (same logic as you wrote) -------------
      - name: Generate summary
        run: |
          # your entire markdown generation block here
          # unchanged

      - name: Upload summary
        uses: actions/upload-artifact@v4
        with:
          name: security-summary
          path: reports/security-summary.md
